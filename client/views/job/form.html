<template name="jobForm">
  <form class="ui job form">
    <input type="hidden" name="_id">

    <div class="fields">
      <div class="four wide field">
        <div class="ui single search selection dropdown">
          <input type="hidden" name="sourceId">
          <i class="dropdown icon"></i>
          <div class="default text">Source</div>
          <div class="menu">
            {{#each source in sources}}
              <div class="item" data-value={{source._id}}>{{source.name}}</div>
            {{/each}}
          </div>
        </div>
      </div>
      <div class="fourteen wide field">
        <input type="text" name="name" placeholder="Job Name">  
      </div>
    </div>

    <div class="field">
      <textarea name="query"></textarea>
    </div>

    <div class="ui fluid styled accordion field">
      <div class="title">
        <i class="dropdown icon"></i> Schedule
        {{#if doc.schedule}}<i class="lightning icon"></i>{{/if}}
      </div>
      <div class="content">{{> jobFormSchedule}}</div>

      <div class="title">
        <i class="dropdown icon"></i> Email
        {{#if doc.email.enabled}}<i class="lightning icon"></i>{{/if}}
      </div>
      <div class="content">{{> jobFormEmail}}</div>
    </div>

    <div class="field">
      <div class="ui buttons">
        <div class="ui submit button {{saveBtnClass}}">save</div>
        {{#if doc._id}}
          <div class="or" data-text="&amp;"></div>
          <div class="ui submit button js-query">run</div>
        {{/if}}
      </div>
      
      {{#if doc._id}}
        &ensp;
        <a href="{{pathFor 'jobView' id=doc._id}}" class="ui basic circular icon button">
          <i class="area chart icon"></i>
        </a>
        
        <div class="ui right floated negative button js-delete">delete</div>
      {{/if}}
    </div>
  </form>

  {{#if doc.result}}
    <h4 class="ui dividing header">
      Result
      <span class="sub header">
        updated {{timeAgo doc.result.updatedAt}}
      </span>
    </h4>

    {{> visualization visType="DataTable" result=doc.result}}
  {{/if}}
</template>


<template name="jobFormSchedule">
  <div class="ui small form">
    <div class="field">
      How often should the job be executed? For more info on syntax have a look at the
      <a href="http://bunkat.github.io/later/parsers.html#text" target="_blank">Text Parser documentation</a>.  
    </div>
    <div class="field">
      <input type="text" name="schedule" placeholder="e.g. every 1 day">  
    </div>
  </div>
</template>


<template name="jobFormEmail">
  <div class="ui small form">
    <div class="field">
      <div class="ui checkbox">
        <input type="checkbox" name="email.enabled">
        <label>enable email notification</label>
      </div>
    </div>
    <div class="field">
      <label>Recipients</label>
      <input type="text" name="email.recipients" placeholder="Recipients">
    </div>
    <div class="field">
      <label>Message</label>
      <input type="text" name="email.subject" placeholder="Subject">
    </div>
    <div class="field">
      <textarea name="email.content"></textarea>
    </div>
  </div>
</template>